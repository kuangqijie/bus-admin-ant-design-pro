(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[22],{58:function(e,t){},eK2U:function(e,t,a){e.exports={wrap:"antd-pro\\pages\\-base\\-station-wrap",map:"antd-pro\\pages\\-base\\-station-map",mapBtn:"antd-pro\\pages\\-base\\-station-mapBtn"}},iU4N:function(e,t,a){"use strict";var n=a("0ZgE"),l=a("VY4n");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("UsS6");var o=n(a("xqAZ")),i=n(a("rFaQ"));a("8EHj");var r=n(a("6xKx"));a("NG6T");var s=n(a("uZXS"));a("sL9k");var u=n(a("BlmP"));a("hjcW");var d=n(a("Tmqy")),f=n(a("+wDg")),c=n(a("U2oY"));a("3PXm");var p=n(a("m2aW"));a("s/1u");var m=n(a("TMZs")),g=n(a("TFzq")),h=n(a("DEU0")),y=n(a("+hkI")),v=n(a("54rf")),E=n(a("oHNe"));a("6ASg");var C=n(a("pKc7"));a("0lkx");var M=n(a("gEKc"));a("M50D");var b=n(a("5Zb7"));a("4Ox4");var w,k,S,T,x,D=n(a("83Te")),N=l(a("PQfD")),V=a("rAnT"),A=(n(a("I9Uw")),n(a("zYb/")),n(a("eK2U"))),z=n(a("CkN6")),P=n(a("zHco")),I=a("vnAF"),F=(D.default.RangePicker,b.default.Item),R=(M.default.TextArea,M.default.Search),O=C.default.Option,U=["","\u70b9","\u9762"],j={labelCol:{span:8},wrapperCol:{span:16}},W=function(e){return Object.keys(e).map(function(t){return e[t]}).join(",")},q=function(e){function t(e){var a;return(0,g.default)(this,t),a=(0,y.default)(this,(0,v.default)(t).call(this,e)),a.map=null,a.type=1,a.areaNum=0,a.polygonOptions={strokeColor:"#1791FC",strokeWeight:2,fillColor:"#1791FC",fillOpacity:.3},a.nodeChange=function(e,t){var n=a.props.updateMapData,l=e.getPath().map(function(e){return e.lng+","+e.lat});n(l)},a.initAreaEdit=function(e,t){var n=new AMap.PolyEditor(a.map,e);n.on("removenode",function(){a.nodeChange(e,t)}),n.on("adjust",function(){a.nodeChange(e,t)});var l=new AMap.ContextMenu;return l.addItem("\u5220\u9664\u6b64\u533a\u57df",function(){n.close(),a.map.remove(e),a.props.updateMapData()},0),e.on("rightclick",function(e){l.open(a.map,e.lnglat)}),n},a.initMap=function(){console.log("init");var e=a.props,t=e.location,n=e.belongCity,l=a.map=new AMap.Map(a.mapRef.current,{resizeEnable:!0,zoom:10}),o=new AMap.Geocoder;function i(e){var t=new I.Promise(function(t,a){o.getAddress(e,function(e,n){if("complete"===e&&n.regeocode){var l=n.regeocode.formattedAddress;t(l)}else a(JSON.stringify(n))})});return t}if(n?l.setCity(n):t&&l.setCenter(t),t){var r=t.map(function(e){return parseFloat(e)});i(r).then(function(e){new AMap.Marker({map:l,position:t,label:{offset:new AMap.Pixel(20,20),content:e}})}).catch(function(e){console.log(e)})}l.on("click",function(e){var t=[e.lnglat.getLng(),e.lnglat.getLat()];console.log(t),i(t).then(function(e){l.clearMap(),new AMap.Marker({map:l,position:t,label:{offset:new AMap.Pixel(20,20),content:e}}),a.props.updateMapData([t.join()])})})},a.initMap2=function(){console.log("init2");var e=a.map=new AMap.Map(a.mapRef.current,{resizeEnable:!0,zoom:10}),t=a.props,n=t.location,l=t.belongCity;l?e.setCity(l):n&&e.setCenter(n);var o=new AMap.MouseTool(e),i=[];AMap.event.addDomListener(a.mapBtnRef.current,"click",function(){if(console.log(a.props.location),a.props.location)m.default.warning("\u6700\u591a\u53ea\u80fd\u7ed8\u5236\u4e00\u4e2a\u533a\u57df");else{o.polygon(a.polygonOptions);for(var e=0;e<i.length;e++){var t=i[e];t.open()}}},!1),AMap.event.addListener(o,"draw",function(e){var t=a.props.updateMapData,n=e.obj.getPath().map(function(e){return e.lng+","+e.lat});a.initAreaEdit(e.obj).open(),console.log(n),t(n),o.close()})},a.mapRef=N.default.createRef(),a.mapBtnRef=N.default.createRef(),a.state={posList:[],type:1,city:""},a}return(0,E.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.location,a=e.stationType,n=e.belongCity;console.log(this.props),1==a?this.initMap(n,t):this.initMap2(n,t)}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.props,n=a.stationType,l=(a.updateMapData,a.preId),o=e.stationType,i=e.nextId,r=this.map;console.log(e),e.isShowModal?n==o&&l==i||(1==o?this.initMap():this.initMap2()):setTimeout(function(){t.initMap()},0),e.belongCity&&e.belongCity!=this.props.belongCity&&(console.log("setCity"),r.setCity(e.belongCity))}},{key:"render",value:function(){var e=this.props.stationType;return N.default.createElement("div",{className:"f-mb10 f-pr"},N.default.createElement("div",{ref:this.mapRef,className:A.default.map}),N.default.createElement("span",{ref:this.mapBtnRef,className:A.default.mapBtn,style:{display:2==e?"":"none"}},N.default.createElement(p.default,{type:"primary"},"\u70b9\u51fb\u7ed8\u5236\u533a\u57df")))}}]),t}(N.PureComponent),B=(w=(0,V.connect)(function(e){var t=e.station,a=e.loading;return{station:t,loading:a.effects["station/fetchCityList"]}}),k=b.default.create(),w(S=k(S=function(e){function t(e){var a;return(0,g.default)(this,t),a=(0,y.default)(this,(0,v.default)(t).call(this,e)),a.flag=!1,a.updateMapData=function(e){console.log(e),a.setState({location:e}),console.log(a.state.location)},a.onTypeChange=function(e){a.setState(function(t,a){return{formVals:(0,c.default)({},t.formVals,{stationType:e})}})},a.onCityChange=function(e){a.setState(function(t,a){return{formVals:(0,c.default)({},t.formVals,{belongCity:e})}})},a.onConfirm=function(){var e=a.props,t=e.onUpdate,n=e.form;n.validateFields(function(e,n){if(!e){var l=a.state,o=l.location,i=l.id,r=(0,c.default)({},n,{location:o,id:i});t(r)}})},a.onCancel=function(){var e=a.props,t=e.setModal,n=e.form;t(!1),n.resetFields(),a.setState({formVals:{}})},a.state={id:"",formVals:{},location:[]},a}return(0,E.default)(t,e),(0,h.default)(t,[{key:"componentWillReceiveProps",value:function(e){console.log(e),e.isShowModal&&!this.flag&&(console.log("set"),this.flag=!0,this.setState({id:e.formVals.id||"",formVals:e.formVals,location:e.formVals.location})),e.isShowModal||(this.flag=!1)}},{key:"render",value:function(){var e=this.props,t=e.isShowModal,a=e.form.getFieldDecorator,n=this.state,l=n.location,o=n.formVals;return N.default.createElement(s.default,{title:"\u6dfb\u52a0\u7ad9\u70b9",visible:t,width:700,onOk:this.onConfirm,onCancel:this.onCancel,maskClosable:!1,destroyOnClose:!0},N.default.createElement(b.default,{layout:"horizontal"},N.default.createElement(u.default,null,N.default.createElement(d.default,{span:12},N.default.createElement(F,(0,f.default)({label:"\u7ad9\u70b9\u7c7b\u578b"},j),a("stationType",{initialValue:U[o.stationType],rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7ad9\u70b9\u7c7b\u578b!"}]})(N.default.createElement(C.default,{placeholder:"\u8bf7\u9009\u62e9",onChange:this.onTypeChange},N.default.createElement(O,{value:"1"},"\u70b9"),N.default.createElement(O,{value:"2"},"\u9762"))))),N.default.createElement(d.default,{span:12},N.default.createElement(F,(0,f.default)({label:"\u6240\u5c5e\u533a\u57df"},j),a("belongCity",{initialValue:o.belongCity,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6240\u5c5e\u533a\u57df!"}]})(N.default.createElement(C.default,{placeholder:"\u8bf7\u9009\u62e9",onChange:this.onCityChange},N.default.createElement(O,{value:"\u5317\u4eac",code:"010"},"\u5317\u4eac"),N.default.createElement(O,{value:"\u4e0a\u6d77",code:"021"},"\u4e0a\u6d77"),N.default.createElement(O,{value:"\u6df1\u5733",code:"0755"},"\u6df1\u5733"),N.default.createElement(O,{value:"\u8861\u9633",code:"0734"},"\u8861\u9633"),N.default.createElement(O,{value:"\u957f\u6c99",code:"0731"},"\u957f\u6c99")))))),N.default.createElement(u.default,null,N.default.createElement(d.default,{span:12},N.default.createElement(F,(0,f.default)({label:"\u7ad9\u70b9\u5168\u79f0"},j),a("name",{initialValue:o.name,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ad9\u70b9\u5168\u79f0!"}]})(N.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u7ad9\u70b9\u5168\u79f0"})))),N.default.createElement(d.default,{span:12},N.default.createElement(F,(0,f.default)({label:"\u7b80\u79f0"},j),a("aliasName",{initialValue:o.aliasName,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7ad9\u70b9\u7b80\u79f0!"}]})(N.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u7ad9\u70b9\u7b80\u79f0"}))))),1==o.stationType&&N.default.createElement(F,{label:"\u8be6\u60c5\u5730\u5740",labelCol:{span:4},wrapperCol:{span:20}},a("address",{initialValue:o.address,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8be6\u60c5\u5730\u5740!"}]})(N.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u8be6\u60c5\u5730\u5740"}))),N.default.createElement(u.default,null,N.default.createElement(d.default,{span:12},N.default.createElement(F,(0,f.default)({label:"\u7f16\u7801"},j),a("code",{initialValue:o.code,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7f16\u7801!"}]})(N.default.createElement(M.default,{placeholder:"\u8bf7\u8f93\u5165\u7f16\u7801"})))))),N.default.createElement(q,{isShowModal:t,stationType:o.stationType,location:l,belongCity:o.belongCity,updateMapData:this.updateMapData}))}}]),t}(N.PureComponent))||S)||S),L=(T=(0,V.connect)(function(e){var t=e.station,a=e.loading;return{station:t,loading:a.effects["station/fetch"]}}),T(x=function(e){function t(){var e,a;(0,g.default)(this,t);for(var n=arguments.length,l=new Array(n),o=0;o<n;o++)l[o]=arguments[o];return a=(0,y.default)(this,(e=(0,v.default)(t)).call.apply(e,[this].concat(l))),a.state={isShowModal:!1,isEdit:!1,pageNum:1,pageSize:10,keyWords:"",formVals:{stationType:1},location:[]},a.onSearch=function(e){a.fetchData({keyWords:e,pageNum:1}),a.setState({keyWords:e,pageNum:1})},a.onTableChange=function(e,t,n){var l=a.state.formValues,o=Object.keys(t).reduce(function(e,a){var n=(0,c.default)({},e);return n[a]=W(t[a]),n},{}),i=(0,c.default)({pageNum:e.current,pageSize:e.pageSize},l,o);a.setState({pageNum:e.current,pageSize:e.pageSize}),a.fetchData(i)},a.columns=[{title:"\u7f16\u53f7",dataIndex:"id"},{title:"\u7ad9\u70b9\u7c7b\u578b",dataIndex:"stationType",filters:[{text:U[0],value:1},{text:U[1],value:2}],filterMultiple:!1,render:function(e){return N.default.createElement("span",null,U[e-1])}},{title:"\u7ad9\u70b9\u5168\u79f0",dataIndex:"name"},{title:"\u7b80\u79f0",dataIndex:"aliasName"},{title:"\u7f16\u7801",dataIndex:"code"},{title:"\u6240\u5c5e\u533a\u57df",dataIndex:"belongCity"},{title:"\u64cd\u4f5c",dataIndex:"operate",width:140,fixed:"right",render:function(e,t,n){return N.default.createElement(N.Fragment,null,N.default.createElement(p.default,{type:"primary",size:"small",className:"f-mr10",onClick:function(){return a.onEdit(t)}},"\u7f16\u8f91"),N.default.createElement(r.default,{title:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u6570\u636e\u5417?",onConfirm:function(){return a.onDelete(t.id,t.delFlag)}},N.default.createElement(p.default,{type:"primary",size:"small",className:"f-bg1"},"\u5220\u9664")))}}],a.setModal=function(e){a.setState({isShowModal:e})},a.onDelete=function(e,t){var n=a.props.dispatch;n({type:"station/delete",payload:{id:e,delFlag:t},callback:function(e){e.status&&m.default.success("\u5220\u9664\u6210\u529f"),a.fetchData()}})},a.onEdit=function(e){var t=(0,c.default)({},e,{location:e.location?e.location.split(","):""});a.setState({formVals:(0,c.default)({},t),location:t.location}),a.setModal(!0)},a.onUpdate=function(e){console.log(e);var t=a.props.dispatch;t({type:"station/update",payload:(0,c.default)((0,i.default)({businessType:"\u5e7f\u4e1c"},"businessType",1),e),callback:function(){console.log(99)}}).then(function(){console.log(100),a.fetchData()}),a.setModal(!1)},a}return(0,E.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"fetchData",value:function(e){var t=this.props.dispatch,a=this.state,n=a.pageNum,l=a.pageSize,o=a.keyWords;t({type:"station/fetch",payload:(0,c.default)({pageNum:n,pageSize:l,keyWords:o},e)})}},{key:"render",value:function(){var e=this,t=this.props,a=t.station,n=t.loading,l={list:a.list,pagination:{current:this.state.pageNum,total:a.total,showTotal:function(e){return"\u5171"+e+"\u6761\u6570\u636e"}}},i={onUpdate:this.onUpdate,setModal:this.setModal,isShowModal:this.state.isShowModal,formVals:this.state.formVals,location:this.state.location};return N.default.createElement(P.default,null,N.default.createElement(o.default,{bordered:!1,className:A.default.wrap},N.default.createElement(u.default,{className:"f-mb20"},N.default.createElement(d.default,{span:6},N.default.createElement(p.default,{type:"primary",onClick:function(){return e.setModal(!0)}},"\u6dfb\u52a0\u7ad9\u70b9")),N.default.createElement(d.default,{span:10,offset:8,xxl:{span:8,offset:10}},N.default.createElement(R,{placeholder:"\u8bf7\u8f93\u5165\u7ad9\u70b9\u540d\u79f0",enterButton:!0,onSearch:function(t){return e.onSearch(t)}}))),N.default.createElement(z.default,{bordered:!0,loading:n,data:l,columns:this.columns,onChange:this.onTableChange,scroll:{x:1e3},rowKey:"id"})),N.default.createElement(B,i))}}]),t}(N.PureComponent))||x);t.default=L}}]);